language: shell

sudo: required

services:
    - docker

env:
    global:
        - REPO=zigarn/owncloud-client
        - secure: "SvxjpOCXbld+eyxGeS/K+wPuzwzYqJzIe/Qap30s3JJJMAmL3TqdiHSEh/Ot5liJUwJ5yLymp+VcjVSpWU3YUiaeh00rlP7Xfc2hjZFREVSGep+NKZBSLXOsQrZFFSCWa+fiGhrD7RXCGT+QId0dd24pDRUtY2jApwn0HO8x962BNKVheCKNw4PWgnClVPEAZx4YGPK3g0gW6zAIbcBbEpVH6Xn7HEANLw86ZDEK7CPVWZKN/Fo5r2BMzSG9BWuzOqhfqxNw03WDIyUD98dWm805DT3SzqYf5Rv+ogvZ9oj7cj/2zWND/Hg6qRS0r48oletezqAQ+E8VOI/Ba1FT6al3Xkynrq2FOaKdeTf4HVsg87E4Xm03yLuCbaynXt83dHdHBwlqnx7wL4TScs9QfsK1b8/J62+fcwjV76/h8+ACW08M/KUH+VDd4Pw+BAMg/9rXDrhfvq9Tuz+vnkNQs5rbDsE5+yZRkMZxyPJs4tKfpGfJ7gKeh36yiNo2CzeQHK6KPStnDTW9UjvEsqc748k996LNgvoqNfnvfv/duapEe/XDiz2ZxAQocAqjG2Dy43l4R7klfOpGQLbwOoVFY56/+63VmckENCcbB5qLgxCDlh1BB8fAHfkGbN07s5Euk4AVk0eHMF1HFWZntSPbTfLwQBEAnYf6jJmTV8/M45I=" # DOCKER_USER
        - secure: "HMMvA+ycPJv0UWIpzHlWm79StOnrRKXEyJ3R7RXRu837UkJj2meRQ1uluYktGu2vZzG2i71ZbVz1/EMWBNkDkwoTLMG6Mb0J0HShoeTz8/Zyw6Mdg+Z+/0JmiDFxu66oKFXKZ4smBpZvmoHhg4zHQgbJoMZgJetGxoTfU0OhfvhwZ857lmUwd+hdsNS1rvmxou5iXljsIBgKJwxiI95Vgg9kNFJCmiwL24ZKpQel1JhwkJ05m1n6qoW0oEVTtNASgIQuGypqakYmNwgSYD6qClnKLUNjg9+nw6pfSLBOpoKC7JiyWNK+4MVPCrjl8PWp42f9q+0wQCuhIVGXvp5u5aCXncXDv3xgftpInQ/8GDSc9WxuDWfo1xWL5+ztqG4l/B+0l8bAJw8wK0H79O8or1ie0dlHfpvbkG80U4ZqxaxSfDoxSCiBlHwlZBQjBUAnEVDhw0sdEnQWVYtYTVmF7P/yuEevhCqPw/7azKa5dEH2HsR+L9/mNuicw5V691maFQ2R3o1Qi15K6ZLn7k5Q6vwrfY1aW5cRlG9TrWVRXM5plYHKi1GdaMd9sor+ojLkE9GBVfkf4yo4u4hQiylmRgAqU6yQTaNgphbkFREUFeTL6/XS4OzlV01MSa0QF16kS8+DCcwYuSE7ZX6o8WJ4Dmkj/DJ3WCLRZCd3bRic7iI=" # DOCKER_PASS

script:
    - export VCS_REF=`git rev-parse --short HEAD`
    - export BUILD_DATE=`date -u +"%Y-%m-%dT%H:%M:%SZ"`
    - export VERSION=`git describe --always HEAD`
    - docker build --build-arg VCS_REF=$VCS_REF --build-arg BUILD_DATE=$BUILD_DATE --build-arg VERSION=$VERSION -t $REPO:$TRAVIS_COMMIT .

after_success:
    - docker login --username $DOCKER_USER --password $DOCKER_PASS
    - export TAG=`if [ "$TRAVIS_TAG" != "" ]; then echo $TRAVIS_TAG; elif [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
    - docker tag $REPO:$TRAVIS_COMMIT $REPO:$TAG
    - docker push $REPO:$TAG
    - curl -X POST 'https://hooks.microbadger.com/images/zigarn/owncloud-client/KmaRqLzPT6n91bYKd-fcmzjN2tY='
